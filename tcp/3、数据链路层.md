<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [数据链路层](#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82)
  - [为什么需要数据链路层](#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82)
  - [数据链路层的基本概念](#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5)
  - [数据链路和帧](#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%92%8C%E5%B8%A7)
  - [使用点对点通信的数据链路层](#%E4%BD%BF%E7%94%A8%E7%82%B9%E5%AF%B9%E7%82%B9%E9%80%9A%E4%BF%A1%E7%9A%84%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82)
  - [数据链路层的三个功能](#%E6%95%B0%E6%8D%AE%E9%93%BE%E8%B7%AF%E5%B1%82%E7%9A%84%E4%B8%89%E4%B8%AA%E5%8A%9F%E8%83%BD)
    - [封装成帧](#%E5%B0%81%E8%A3%85%E6%88%90%E5%B8%A7)
    - [透明传输](#%E9%80%8F%E6%98%8E%E4%BC%A0%E8%BE%93)
    - [差错控制](#%E5%B7%AE%E9%94%99%E6%8E%A7%E5%88%B6)
  - [参考](#%E5%8F%82%E8%80%83)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## 数据链路层

### 为什么需要数据链路层

数据链路层主要有两个功能 ：帧编码和误差纠正控制。  

1、帧编码    

在相邻的两个节点之间传送数据时，数据链路层会将网络层交下来的 IP 数据报组装成帧，在两个相邻节点之间传送帧。每一帧包括数据和必要的控制信息(如同步信息、地址信息、差错控制等)

这样在接收数据的时候，接收端就能从控制信息中知道一个帧物理层的线路由传输介质与通信设备组成从哪个比特开始，哪个比特结束。这样数据链路层就能在收到每一帧之后，从中提取出数据部分，交给网络层。  

2、误差纠正控制  

控制信息还使接收端能检测到所收到的帧中有无差错。如发现有差错，数据链路层就简单地丢弃这个出了差错的帧，以免继续传送下去白白浪费网络资源。如需改正错误，就由运输层的TCP协议来完成。链路层不仅检错，还能纠错。  

<img src="/img/ip/ip-data-link-connect.jpg"  alt="tcp" />    

### 数据链路层的基本概念

数据链路层属于计算机网络的底层，数据链路层使用的信道主要有下面两种类型：  

1、点对点信道。这种信道使用一对一点对点的通信方式。  

2、广播通信。这种通信使用一对一多的广播模式。广播信道上连接的主机很多，因此必须使用专有的共享通道协议来协调这些主机的数据发送。  

### 数据链路和帧

这里先来明确下链路和数据链路的区别  

链路：结点间的物理通道。是⼀条⽆源的点到点的物理线路段（双绞线、光纤等），中间没有任何其他交换结点。⼀条链路只是⼀条通路的⼀个组成部分；   

数据链路：当需要在一条数据上传输数据时，除了需要有一条物理线路，还需要一些必要的通信协议来控制这些数据的传输。把实现这些协议软件和硬件加到链路上，就构成了数据链路。   

`数据链路=链路+协议`  

数据链路的栗子：  

城市交通=街道+汽⻋交通规则；    

铁路交通=铁轨+⽕⻋运⾏规则；  

帧：链路层的协议数据单元，封装网络层的数据报。   

数据链路层：负责通过⼀条链路从⼀个结点向物理链路直接相连的相邻结点传送帧。     

### 使用点对点通信的数据链路层

使用点对点信道的数据链路层在通信有下面三个步骤  

1、A 的数据链路层把⽹络层交下来的 IP 数据报添加⾸部和尾部封装成帧；  

2、A 把封装好的帧发送给B的数据链路层；  

3、B 的数据链路层收到的帧⽆差错，从帧中取出 IP 数据报交给⽹络层；否则丢弃这个帧。   

<img src="/img/ip/ip-data-link-point-to-point.jpg"  alt="tcp" />    

数据链路层不必考虑物理层如何实现⽐特传输的细节。甚⾄还可以简单地设想好像是沿着两个数据链路层之间的⽔平⽅向把帧直接发送到对⽅。   

<img src="/img/ip/ip-data-link-point.jpg"  alt="tcp" />    

### 数据链路层的三个功能  

数据链路的三个基本功能：分装成帧、透明传输和差错控制。  

<img src="/img/ip/ip-data-link-base-function.jpg"  alt="tcp" />     

#### 封装成帧

封装成帧：就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧。首部和尾部的一个重要的作用就是进行帧定界，确定帧的边界。   

<img src="/img/ip/ip-data-link-mtu.jpg"  alt="tcp" />     

当数据是由可打印的 ASCII 码组成的⽂本⽂件时，帧定界可以使⽤特殊的帧定界符。    

控制字符 `SOH (Start Of Header)` 放在⼀帧的最前⾯，表示帧的⾸部开始，控制字符 `EOT (End Of Transmission)` 表示帧的结束。   

<img src="/img/ip/ip-data-link-soh.jpg"  alt="tcp" />    

为什么需要封装成帧？   

当传输数据的时候出现了故障，帧界定符的作用就更加明显了。如果发送端在发送的过程中，一个帧出现了故障，中断了传输，之后很快又重新从头开始传送。由于使用了帧的界定符，接收端，就能根据界定符来 判断帧是否是一个完整的帧，如果不是完整的帧就会丢弃。    

简单的讲就是可以判断错误的帧。   

#### 透明传输  

在数据链路层透明传输表示：无论什么比特组成的数据，都能按照原样没有差错的通过这个数据链路层。  

如果数据中的某个字节的⼆进制代码恰好和 SOH 或 EOT ⼀样，数据链路层就会`错误地找到帧的边界`。  

<img src="/img/ip/ip-data-link-eot.jpg"  alt="tcp" />    

因为存在这种错误帧的情况，上面的这种情况就不是透明传输，因为传输的数据中有字符 EOT，接收端就会认为帧的传输已经结束了，后面的内容就不能进行传输了，就会造成数据的丢失。   

如何解决呢？  

通过在控制符 SOH 和 EOT 前面插入一个转义字符 ESC 来解决，这样界定符前面都会有一个转义字符，就能和数据中的字符进行区分了，不会把数据中的字符当成帧中的界定符来处理。    

- 发送端的数据链路层在数据中出现控制字符“SOH”或“EOT”的前⾯插⼊⼀个转义字符“ESC”；   

- 接收端的数据链路层在将数据送往⽹络层之前删除插⼊的转义字符；

- 如果转义字符也出现在数据当中，那么应在转义字符前⾯插⼊⼀个转义字符 ESC。当接收端收到连续的两个转义字符时，就删除其中前⾯的⼀个。

<img src="/img/ip/ip-data-link-esc.jpg"  alt="tcp" />

#### 差错控制


### 参考

【极客时间-趣谈网络协议】https://time.geekbang.org/column/intro/100007101  
【计算机网络第八版】https://www.bilibili.com/video/BV1WP4y1j7JU?p=1  
【计算机网络学习笔记】https://github.com/boilingfrog/Go-POINT/tree/master/tcp  
【计算机网络-物理层】https://boilingfrog.github.io/2022/07/12/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C-%E7%89%A9%E7%90%86%E5%B1%82/  


