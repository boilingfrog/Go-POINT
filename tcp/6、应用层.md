<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [应用层](#%E5%BA%94%E7%94%A8%E5%B1%82)
  - [为什么需要应用层](#%E4%B8%BA%E4%BB%80%E4%B9%88%E9%9C%80%E8%A6%81%E5%BA%94%E7%94%A8%E5%B1%82)
  - [工作模式](#%E5%B7%A5%E4%BD%9C%E6%A8%A1%E5%BC%8F)
  - [域名系统](#%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F)
    - [根域名服务器](#%E6%A0%B9%E5%9F%9F%E5%90%8D%E6%9C%8D%E5%8A%A1%E5%99%A8)
    - [域名解析的过程](#%E5%9F%9F%E5%90%8D%E8%A7%A3%E6%9E%90%E7%9A%84%E8%BF%87%E7%A8%8B)
    - [DNS 服务器高速缓存](#dns-%E6%9C%8D%E5%8A%A1%E5%99%A8%E9%AB%98%E9%80%9F%E7%BC%93%E5%AD%98)
  - [FTP](#ftp)
  - [参考](#%E5%8F%82%E8%80%83)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## 应用层

### 为什么需要应用层

运输层给应用进程提供了端到端的通信服务，但不同的网络进程之间，还需要有不同的通信规则，因此运输层之上还需要有应用层。   

**应用层协议定义**：  

- 应⽤进程交换的报⽂类型，请求还是响应？  

- 各种报⽂类型的语法、语义；  

- 进程何时、如何发送报⽂，以及对报⽂进⾏响应的规则。    

**应用层功能与协议**：   

- 域名服务：DNS；   

- ⽂件传输：FTP；   

- 电⼦邮件：SMTP、POP3；     

- 远程登陆：TELNET；    

- WWW服务：HTTP。   

### 工作模式

应用层有两种工作模式：`Client/Server` 模式和 P2P 模式。   

**Client/Server**  

服务器：  

- 提供⽹络服务的设备（由硬件和服务软件组成）；  

- 永久提供服务；   

- 有永久性访问地址/域名；  

- 通常采⽤多线程或多进程实现。  

客户机：  

- 请求服务的主机；  

- 与服务器通信，使⽤服务器提供的服务；  

- 间歇性接⼊⽹络；  

- 可能使⽤动态IP地址；  

- 不与其他客户直接通信。

**P2P-特殊的客户服务器⽅式**

- 不存在永远在线的服务器；  

- 每个主机既可提供服务，也可以请求服务；     

- 任意端系统/节点之间可以直接通信；   

- 结点间歇性接⼊⽹络；  

- 结点可能改变IP地址。  

优点  

- 可扩展性好；   

- ⽹络健壮性好；

- 资源分散管理。

### 域名系统

域名系统是互联网使用的命名系统，用来便于人们使用的机器名字转换成 IP 地址。点分⼗进制的 IP 地址不容易记住⽽使⽤域名，类似⼈们的身份证号码不易记住⽽使⽤姓名。数字适合于机器，名字适合于⼈类。  

<img src="/img/ip/ip-application-domain-class.jpg"  alt="tcp" />      

域名结构，级别最低的域名卸载最左边，级别最高的域名就写在最右边。   

#### 根域名服务器

根域名服务器是最高层次，最重要的域名服务器。根域名服务器知道所有的顶级域名服务器的域名和 IP 地址。本地域名服务器要对互联⽹上任何⼀个域名进⾏解析，如果⾃⼰⽆法解析，⾸先求助根域名服务器。  

#### 域名解析的过程

- 主机向本地域名服务器的查询采⽤递归查询。如果本地域名服务器不能解析域名的 IP 地址，本地域名服务器就以 DNS 客户的身份，向根域名服务器发出查询请求报⽂；  

- 本地域名服务器向根域名服务器的查询采⽤迭代查询。当根域名服务器收到本地域名服务器的迭代查询请求报⽂时，要么给出所要查询的 IP 地址，要么告诉本地域名服务器：“你下⼀步应当向哪⼀个域名服务器进⾏查询”。  

<img src="/img/ip/ip-application-domain-search.jpg"  alt="tcp" />      

#### DNS 服务器高速缓存

每个域名服务器都回维护一个告诉缓存，存放最近用过的名字以及从何处获取名字的映射信息的记录。  

可⼤⼤减轻根域名服务器的负荷，使互联⽹上的 DNS 查询请求和回答报⽂的数量⼤为减少。   

为保持高速缓存中的内容正确，域名服务器需要为每项内容设置过期计时器，然后过期删除。   

### FTP

FTP 文件传输协议，是互联网中使用最广泛的文件传输协议。   

- FTP 实现的是通过⽹络实现异构计算机间⽂件的“拷⻉”；   

- FTP 屏蔽了计算机系统的细节，适合在异构⽹络中任意计算机之间传送⽂件。   

- FTP 提供交互式的访问，允许客户指明⽂件的类型与格式，并允许⽂件具有存取权限。  

#### FTP 的工作原理

FTP 采⽤ C/S 模式，可为多个客户提供服务；  

FTP 的服务器进程由两⼤部分组成：⼀个主进程，负责接受新的请求；另外有若⼲个从属进程，负责处理单个请求；  

消除了不同操作系统下的⽂件系统的不兼容性；   

实现了⽂件传送的基本服务；     

使⽤ TCP 可靠传输协议。    

<img src="/img/ip/ip-application-ftp.jpg"  alt="tcp" />      

客户端使⽤任意分配的端⼝号（>1023),服务器端⽤熟知端⼝号21传输控制信息,服务器端⽤熟知端⼝号20传输数据。     

1、服务器主程序打开21号端⼝，等待客户进程发送连接请求；  

2、启动从属进程处理客户进程请求；  

3、回到等待状态，继续接受其他客户进程请求。     

**使⽤两个不同端⼝号的好处**   

1、使协议更加简单和更容易实现；  

2、在传输⽂件时还可以利⽤控制连接。  




### 参考

【极客时间-趣谈网络协议】https://time.geekbang.org/column/intro/100007101  
【计算机网络第八版】https://www.bilibili.com/video/BV1WP4y1j7JU?p=1  
【计算机网络学习笔记】https://github.com/boilingfrog/Go-POINT/tree/master/tcp  