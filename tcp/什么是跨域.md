<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [什么是跨域](#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%A8%E5%9F%9F)
  - [前言](#%E5%89%8D%E8%A8%80)
  - [什么是跨域](#%E4%BB%80%E4%B9%88%E6%98%AF%E8%B7%A8%E5%9F%9F-1)
  - [同源策略](#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5)
    - [什么是同源策略](#%E4%BB%80%E4%B9%88%E6%98%AF%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5)
    - [非同源的限制条件](#%E9%9D%9E%E5%90%8C%E6%BA%90%E7%9A%84%E9%99%90%E5%88%B6%E6%9D%A1%E4%BB%B6)
    - [同源策略的目的](#%E5%90%8C%E6%BA%90%E7%AD%96%E7%95%A5%E7%9A%84%E7%9B%AE%E7%9A%84)
  - [如何处理跨域](#%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E8%B7%A8%E5%9F%9F)
    - [处理 AJAX 非同源的限制](#%E5%A4%84%E7%90%86-ajax-%E9%9D%9E%E5%90%8C%E6%BA%90%E7%9A%84%E9%99%90%E5%88%B6)
  - [参考](#%E5%8F%82%E8%80%83)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## 什么是跨域

### 前言

作为一名后端开发工程师，在给前端同事写接口的时候，经常碰到他们讲，你的接口跨域了，那么什么是跨域，这里来研究下。   

### 什么是跨域

先来看下跨域的定义  

跨域的广义定义：跨域是指一个域下的文档或脚本试图去请求另一个域下的资源。  

我们经常遇到的跨域是由浏览器同源策略限制的一类请求场景。  

栗如，下面的请求就发生了跨域，在京东的 H5 页面中请求淘宝的接口  

<img src="/img/ip/cors_1.jpg"  alt="redis" align="tcp" />  

上面栗子中跨域最终的罪魁祸首就是浏览器的同源策略。  

1、因为上面的**域名**不相同，所以请求的接口被认为是非同源。    

2、同时出于安全性，浏览器限制脚本内发起的跨源 HTTP 请求。 例如，`XMLHttpRequest` 和 `Fetch API` 遵循同源策略。所以上面的请求就报了跨域的错误。  

### 同源策略

#### 什么是同源策略

同源策略/SOP `（Same origin policy）`是一种约定，由 Netscape 公司1995年引入浏览器。  

同源策略是指在 Web 浏览器中，允许某个网站脚本访问另一个网站的数据，但前提是这两个网站必须满足三个相同:     

1、协议相同；    

2、域名相同；   
 
3、端口相同； 

一旦两个网站满足上述条件，这两个网站就被认定为具有相同来源。  

#### 非同源的限制条件

如果两个网站非同源，将受到下面的几种限制  

1、Cookie、LocalStorage 和 IndexDB 无法读取；  

2、DOM 无法获得；  

3、AJAX 请求不能发送。  

#### 同源策略的目的

同源政策的目的，是为了保证用户信息的安全，防止恶意的网站窃取数据。  

栗如：Cookie 中存了一些用户的登陆信息，如果没有同源策略的限制，那么任何网站都能访问 Cookie，用户的信息就会泄露了，就能伪造用户信息登陆目标网站了，这显然是有很大的安全隐患的。   

### 如何处理跨域

因为非同源有上面三种限制，这种能够规避一定的安全问题，但是有时候我们正常的使用也受到了影响，所以有时候我们需要想办法规避这种限制。  

非同源限制中的   

1、Cookie、LocalStorage 和 IndexDB 无法读取；  

2、DOM 无法获得； 

这里就不展开讨论了，这中只需要在前端页面中进行调整就行了，这里重点关注下有和后端交互的 `3、AJAX 请求不能发送` 的这种限制。  

#### 处理 AJAX 非同源的限制

同源政策规定，AJAX 请求只能发给同源的网址，否则就报错。  

除了架设服务器代理（浏览器请求同源服务器，再由后者请求外部服务），有三种方法规避这个限制。  

1、JSONP  

2、WebSocket  

3、CORS  





### 参考

【跨域资源共享 CORS 详解】https://www.ruanyifeng.com/blog/2016/04/cors.html  
【前端常见跨域解决方案】https://segmentfault.com/a/1190000011145364    
【浏览器同源政策及其规避方法】https://www.ruanyifeng.com/blog/2016/04/same-origin-policy.html  
【Same-origin_policy】https://en.wikipedia.org/wiki/Same-origin_policy  
