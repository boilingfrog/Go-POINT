## tcp/ip

### 第一章

tcp/ip的分层

可分为四层  

1、应用层

负责处理特定的应用程序的细节。   

2、运输层  

主要为两台主机上的应用程序提供端到端的通信，主要是tcp和udp。   

3、网络层  

也称作互联网层，处理分组在网络中的活动。例如分组的选路。在`TCP/IP`协议族中，网络层协议包括 IP协议（网际协议），ICMP协议（Internet互联网控制报文协议），以及IGMP协议（Internet组管理协议）。  

4、链路层  

有时也称作数据链路层或网络接口层，通常包括操作系统中的设备驱动程序和计算机中对应的网络接口卡。它们一起处理与电缆（或其他任何传输媒介）的物理接口细节。  

![tcp-ip](/img/tcp-ip_1.jpg?raw=true)

#### 数据的封装

当程序使用tcp传输数据的时候，数据被送入协议栈，然后逐个通过每一层，最后被当成比特流送入网络。在通过每一层的时候，都会对数据增加一些头部信息或尾部信息，来封装请求的数据。  

![tcp-ip](/img/tcp-ip_2.jpg?raw=true)

TCP传给IP的数据单元称作 TCP报文段或简称为 TCP段（TCP segment）。  

IP传给网络接口层的数据单元称作 IP数据报(IP datagram)。  

通过以太网传输的比特 流称作帧(Frame)。  

由于TCP、UDP、ICMP和IGMP都要向IP传送数据，因此IP必须在生成的IP首部中加入某种标识，以表明数据属于哪一层。为此，IP在首部中存入一个长度为8bit的数值，称作协议域。  

- 1表示为ICMP协议，
- 2表示为IGMP协议，
- 6表示为TCP协议， 
- 17表示为UDP协议。  

### 链路层

数据链路层指的是OSI参数模型中的s数据链路层，有时也指以太网，无限局域网等通信手段。   

数据链路层的协议定义了通过通信媒介互联的设别之间传输的规范。通信的媒介包括，双绞电缆、通州光缆、光纤... 

链路层主要有三个目的：  
1、为IP模块发送和 接收IP数据报；  
2、为ARP模块发送ARP请求和接收ARP应答；  
3、为RARP发送RARP请 求和接收RARP应答。   

### IP

![tcp-ip](/img/tcp-ip_3.jpg?raw=true)

IP位于OSI参考模型中的d第三层-网络层。   

网络层的主要作用是实现"终端之间的通信"、这种通信也叫点对点通信。   

IP是TCP/IP协议族中最为核心的协议。所有的 TCP、UDP、ICMP及IGMP数据都以IP数据 报格式传输。  

#### 网络层和数据链路层的关系

数据链路层负责两个设备之间的通信。   

网路层的IP负责在没有直连的两个网络之间通信。   

一个完整的网络层通信，可能存在多个设备之间的通信，也就是很多不同的数据链路层构成了一个完整的网络层的通信。   

#### IP地址和硬件地址

硬件地址：是数据链路层和物理层使用的地址;    

IP地址：是网络层和以上各层使用的地址，是一种逻辑地址。  

<img src="/img/tcp-ip_4.jpg" width = "978" height = "322" alt="tcp-ip" align="center" />

注意：在局域网中，由于硬件地址是固话在网卡上的ROM中，因此常常将硬件地址称为物理地址。因为在局域网中，MAC帧中的源地址和目标地址都是硬件地址，因此硬件地址又称为MAC地址。  

在发送数据报时，数据从上高层下到低层，然后到通信链路层上传输。使用IP的数据报，一但交给数据链路层，就会被封装成MAC帧了。然后MAC帧在传送的时使用的源地址和目标地址都是硬件地址，这两个硬件地址都写在Mac帧的首部中。   

对于MAC帧来讲，在不同局域网中的MAC地址可能不同，但是里面封装的IP地址源地址和目标地址是不变的，MAC帧经过几个不同的局域网，最后把IP数据包，送达到目标地址。  

![tcp-ip](/img/tcp-ip_5.jpg?raw=true)

#### 地址解析协议ARP

ARP: 根据机器的的IP地址，找出其相应的硬件地址。  

通过在主机的ARP缓存放一个从IP地址到硬件的地址的映射表来实现的。这个映射表是动态更新的，并且会设置过期时间。   

#### IP数据报格式

在TCP/IP标准中，各种数据尝尝以32位（4字节）来描述。  

![tcp-ip](/img/tcp-ip_6.jpg?raw=true)










