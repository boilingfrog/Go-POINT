## linux中的权限

### 前言

最近使用`ansible`搭建了mongo的`replica set`。发现很多次的失败都是文件权限不对造成的。那么就总结下吧。  

### 深入了解

linux中的文件权限分为读、写、执行.对应的字母就是r、w、x.  

- 读   
Read对文件而言，具有读取文件内容的权限；对目录来说，具有浏览该目录信息的权限。  
- 写  
Write对文件而言，具有修改文件内容的权限；对于目录来说，具有删除移动目录内文件的权限。  
- 执行  
Execute对文件而言，具有执行文件的权限；对目录来说，具有进入目录的权限。  
- 无权限  
`-`表示不具有该项选项  

linux下的权限粒度有 `拥有者`、`群组`、`其他组`三种。每个文件都可以针对这三个粒度，设置不同的(r,w,x)读写执行权限。通常情况下，一个文件只能归属于一个用户和组， 如果其它的用户想有这个文件的权限，则可以将该用户加入具备权限的群组，一个用户可以同时归属于多个组。  

Linux上通常使用chmod命令对文件的权限进行设置和更改。  

### 数字权限

我们规定数字4、2、1表示读、写、执行的权限。即r=4，w=2，x=1。  

栗如:  

````
rwx = 4 + 2 + 1 = 7
rw = 4 + 2 = 6
rx = 4 +1 = 5
````

即  

若要同时设置 rwx (可读写运行） 权限则将该权限位 设置 为 4 + 2 + 1 = 7  

若要同时设置 rw- （可读写不可运行）权限则将该权限位 设置 为 4 + 2 = 6  

若要同时设置 r-x （可读可运行不可写）权限则将该权限位 设置 为 4 +1 = 5  

每个文件都有`拥有者`、`群组`、`其他组`三种权限的粒度。我们在设置权限的时候也是针对这几个粒度进行配置的。即我们可以使用三个数字来配置这三个权限粒度的权限。  

> chmod <abc> file...

````
其中
a,b,c各为一个数字，分别代表User、Group、及Other的权限。
相当于简化版的
chmod u=权限,g=权限,o=权限 file...
而此处的权限将用8进制的数字来表示User、Group、及Other的读、写、执行权限
````

栗子：  

设置所有人读写执行

````
chmod 777 file
````

### 分析下数字权限

读，写，执行对应的权限二进制表示为

```
r-- = 100
-w- = 010
--x = 001
--- = 000
```

将二进制转换成十进制就是

```
r-- = 100 4
-w- = 010 2
--x = 001 1
--- = 000 0
```

故

```
rwx 权限就是 4 + 2 + 1 = 7  
rw- 权限就是 4 + 2 = 6 
...
```

#### 四位数字权限

linux除了设置正常的读写操作权限外，还有关于一类设置也是涉及到权限，叫做Linxu附加权限。包括 SET位权限（suid，sgid）和粘滞位权限（sticky）。  

SET位权限：  

`suid/sgid`是为了使“没有取得特权用户要完成一项必须要有特权才可以执行的任务”而产生的。 一般用于给可执行的程序或脚本文件进行设置，其中SUID表示对属主用户增加SET位权限，SGID表示对属组内用户增加SET位权限。执行文件被设置了`SUID、SGID`权限后，任何用户执行该文件时，将获得该文件属主、属组账号对应的身份。在许多环境中，suid 和 sgid 很管用，但是不恰当地使用这些位可能使系统的安全遭到破坏。所以应该尽量避免使用SET位权限程序。（passwd 命令是为数不多的必须使用“suid”的命令之一）。  

- suid(set User ID,set UID)的意思是进程执行一个文件时通常保持进程拥有者的UID。然而，如果设置了可执行文件的suid位，进程就获得了该文件拥有者的UID。  



