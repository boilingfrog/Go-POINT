<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [数据库中阻塞语句的查询和分析](#%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%AD%E9%98%BB%E5%A1%9E%E8%AF%AD%E5%8F%A5%E7%9A%84%E6%9F%A5%E8%AF%A2%E5%92%8C%E5%88%86%E6%9E%90)
  - [前言](#%E5%89%8D%E8%A8%80)
  - [MySQL](#mysql)
  - [参考](#%E5%8F%82%E8%80%83)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## 数据库中阻塞语句的查询和分析

### 前言

MySQL 阻塞是指在并发访问 MySQL 数据库时，某个事务占用了资源并且长时间不释放，导致其他事务无法执行或执行缓慢的情况。  

MySQL 阻塞可能会导致数据库性能下降，甚至出现死锁等问题，需要马上进行处理。    
 
在 MySQL中，线程阻塞可能是由于以下原因导致：   

1、锁冲突：如果两个或者多个线程同时请求同一个资源(栗如：同一行或者同一个表)，其中一个将被阻塞，直到其他线程释放锁；   

2、长事务：如果一个事务占用锁的时间过长，可能会导致其它事务长时间等待甚至是超时；   

3、死锁：如果两个线程或者更多的线程相互等待对方的资源，将会发生死锁(Deadlock)，进而导致语句的执行阻塞。      

如何排查和定位阻塞语句呢，下面来分析下？    

### MySQL  

面对阻塞的语句如何查看呢？  

首先我们来模拟2个阻塞的场景，然后使用命令来排查定位。    

准备数据   

````
CREATE TABLE `t` (
  `id` int(11) NOT NULL AUTO_INCREMENT,
  `c` int(11) DEFAULT NULL,
  `d` int(11) DEFAULT NULL,
  PRIMARY KEY (`id`),
  UNIQUE KEY `c` (`c`)
) ENGINE=InnoDB;


insert into t values(null, 1,1);
insert into t values(null, 2,2);
insert into t values(null, 3,3);
insert into t values(null, 4,4);
````

模拟长事务的场景   

```


```


### 参考

【mysql阻塞怎么处理】https://juejin.cn/s/mysql%E9%98%BB%E5%A1%9E%E6%80%8E%E4%B9%88%E5%A4%84%E7%90%86     
【mysql线程阻塞】https://juejin.cn/s/mysql%E7%BA%BF%E7%A8%8B%E9%98%BB%E5%A1%9E     