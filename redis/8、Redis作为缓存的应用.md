<!-- START doctoc generated TOC please keep comment here to allow auto update -->
<!-- DON'T EDIT THIS SECTION, INSTEAD RE-RUN doctoc TO UPDATE -->

- [如何使用 Redis 缓存](#%E5%A6%82%E4%BD%95%E4%BD%BF%E7%94%A8-redis-%E7%BC%93%E5%AD%98)
  - [前言](#%E5%89%8D%E8%A8%80)
  - [旁路缓存](#%E6%97%81%E8%B7%AF%E7%BC%93%E5%AD%98)
    - [只读缓存](#%E5%8F%AA%E8%AF%BB%E7%BC%93%E5%AD%98)
    - [读写缓存](#%E8%AF%BB%E5%86%99%E7%BC%93%E5%AD%98)

<!-- END doctoc generated TOC please keep comment here to allow auto update -->

## 如何使用 Redis 缓存

### 前言

对于 Redis 来讲，作为缓存使用，是我们在业务中经常使用的，这里总结下，Redis 作为缓存在业务中的使用。  

### 旁路缓存

Cache Aside（旁路缓存）策略以数据库中的数据为准，缓存中的数据是按需加载的。它可以分为读策略和写策略。   

#### 只读缓存

只读缓存 从缓存中读取数据；如果缓存命中，则直接返回数据；如果缓存不命中，则从数据库中查询数据；查询到数据后，将数据写入到缓存中，并且返回给用户。  

如归需要对数据进行修改的时候，直接修改数据库中的数据，然后删除缓存中的旧数据。   

只读缓存的优点：  

所有最新的数据都在数据库中，数据不存在丢失的风险。    

#### 读写缓存

除了进行读操作外，数据的修改操作也会发送到缓存中，直接在缓存中对数据进行修改。此时，得益于Redis的高性能访问特性，数据的增删改操作可以在缓存中快速完成，处理结果也会快速返回给业务应用，这就可以提升业务应用的响应速度。  

当然 Redis 是内存数据库，一旦掉电或宕机，内存中的数据就有可能存在丢失。  

针对这种情况，一般会有两种回写策略：  

- 1、同步回写；  

写请求发给缓存的同时，也会发给后端数据库进行处理，等到缓存和数据库都写完数据，才给客户端返回。这样，即使缓存宕机或发生故障，最新的数据仍然保存在数据库中，这就提供了数据可靠性保证。  

不过，同步直写会降低缓存的访问性能。这是因为缓存中处理写请求的速度是很快的，而数据库处理写请求的速度较慢。即使缓存很快地处理了写请求，也需要等待数据库处理完所有的写请求，才能给应用返回结果，这就增加了缓存的响应延迟。  

- 2、异步回写。  

所有写请求都先在缓存中处理。可以定时将缓存写入到内存中，然后等到这些增改的数据要被从缓存中淘汰出来时，再次将它们写回后端数据库。这样一来，处理这些数据的操作是在缓存中进行的，很快就能完成。只不过，如果发生了掉电，而它们还没有被写回数据库，就会有丢失的风险了。    
